#!/bin/sh
# Pre-commit hook for HireReady

echo "ðŸ” Running pre-commit checks..."

# 1. Check for .env files being committed
echo "ðŸ” Checking for secrets..."
if git diff --cached --name-only | grep -E "^\.env(\..+)?$" | grep -v "\.env\.example$"; then
    echo "âŒ Attempting to commit .env file! This is not allowed."
    exit 1
fi

# 2. Large file check (prevent files > 5MB)
echo "ðŸ“¦ Checking file sizes..."
for file in $(git diff --cached --name-only --diff-filter=ACMR); do
    if [ -f "$file" ]; then
        size=$(wc -c < "$file" | tr -d ' ')
        if [ "$size" -gt 5242880 ]; then
            echo "âŒ Large file detected: $file ($(($size / 1024 / 1024))MB)"
            exit 1
        fi
    fi
done

# 3. Run lint-staged (ESLint + Prettier)
echo "âœ¨ Running lint-staged..."
pnpm lint-staged || exit 1

# 4. Run TypeScript type check
echo "ðŸ“ Running TypeScript type check..."
pnpm type-check || exit 1

echo "âœ… All pre-commit checks passed!"
